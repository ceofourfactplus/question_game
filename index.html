<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        .hidden {
            display: none;
        }

        body {
            font-family: 'Fira Code', monospace;
        }
    </style>
</head>

<body class="">
    <div class="container mt-4">
        <div class="card text-bg-dark mb-3 text-start" style="height: 300px;">
            <div class="card-header fs-4">Question</div>
            <div class="card-body">
                <h3 class="text-light fs-1" id="question">SELECT <br>* TABLE</h3>
            </div>
        </div>

        <div class="card text-bg-danger mb-3 text-start" style="height: 200px;">
            <div class="card-header fs-4">Answer</div>
            <div class="card-body">
                <h3 class="text-light fs-1" id="answer">FROM</h3>
            </div>
        </div>

        <div class="d-flex justify-content-end">
            <div class="me-2 align-items-center dflex">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" onchange="is_random = !is_random"
                        id="flexCheckDefault">
                    <label class="form-check-label" for="flexCheckDefault">
                        Random
                    </label>
                </div>
            </div>
            <div class="me-2">
                <div class="input-group input-group-lg">
                    <span class="input-group-text">Level</span>
                    <select id="level-input" class="form-select" aria-label="Default select example"
                        onchange="changeLevel()">
                        <option selected value="1">Easy</option>
                        <option value="2">Hard</option>
                    </select>
                </div>
            </div>
            <div class="flex-1">
                <button type="button" class="btn btn-lg btn-warning" onclick="RandomQuestion()">Run</button>
                <button type="button" class="btn btn-lg btn-danger" onclick="Answer()">Answer</button>
            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
    <script src="./questions.js"></script>
    <script>
        var question_dom = document.getElementById("question");
        var answer_dom = document.getElementById("answer");
        var run_audio = new Audio('run1.mp3');
        var quack_audio = new Audio('quack.mp3');
        var filtered_question_list = question_list;
        var question = {};
        var question_index = 0;
        var level = 1
        var is_answer = false
        var is_runing = false
        var is_random = false

        function Answer() {
            if (is_runing) {
                return
            }
            quack_audio.play()
            typingText(question.answer, answer_dom);
        }

        function RandomQuestion() {
            if (is_runing) {
                return
            }
            if (is_random) {
                question = filtered_question_list[Math.floor(Math.random() * filtered_question_list.length)];
            } else {
                question = filtered_question_list[question_index];
                question_index++;
            }
            typingText(question.question, question_dom, run_audio);
            answer_dom.innerHTML = '...';
        }


        function typingText(text, dom, audio = null, speed = 10) {
            if (level == 2) {
                speed = 5
            }

            let charIndex = 0;
            dom.innerHTML = "";
            is_runing = true

            if (audio) {
                audio.currentTime = 0
                audio.play();
            }

            function type() {
                if (charIndex < text.length) {
                    dom.innerHTML += text.charAt(charIndex);
                    charIndex++;
                    setTimeout(type, speed);
                } else {
                    if (audio) {
                        audio.pause();
                    }
                    is_runing = false
                }
            }
            type();
        }

        function changeLevel() {
            level = document.getElementById("level-input").value
            level = parseInt(level)
            question_index = 0
            filtered_question_list = question_list.filter((item) => item.level == level)
        }

        document.addEventListener("keydown", function (event) {
            if (event.code === "Space" && !is_runing) {
                if (is_answer) {
                    Answer();
                } else {
                    RandomQuestion();
                }
                is_answer = !is_answer
            }
        });

        changeLevel()
        RandomQuestion();
    </script>
</body>

</html>